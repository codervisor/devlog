{
  "id": 253,
  "key": "fix-statistics-discrepancy-time-series-shows-43-op",
  "title": "Fix: Statistics discrepancy - time series shows 43 open devlogs vs overview shows 12",
  "type": "bugfix",
  "description": "Investigating significant discrepancy between time series statistics reporting 43 open devlogs and overview statistics reporting only 12 open devlogs. This suggests inconsistent counting logic or filtering criteria between different statistics collection methods.",
  "status": "done",
  "priority": "high",
  "createdAt": "2025-07-23T15:47:30.018Z",
  "updatedAt": "2025-07-23T16:21:17.588Z",
  "notes": [
    {
      "id": "c8e61eec-082f-47f0-9420-80fda94e104b",
      "timestamp": "2025-07-23T15:48:32.946Z",
      "category": "issue",
      "content": "Identified the root cause: Time series uses `totalCreated - totalClosed` where `totalClosed` requires both status='done'|'cancelled' AND closedAt field to be set. Overview stats only checks status. This suggests some devlogs have status='done'|'cancelled' but missing closedAt field, causing them to be counted as \"closed\" in overview but \"open\" in time series."
    },
    {
      "id": "0f47ae44-9e56-46cc-b62e-7a3b55ad5028",
      "timestamp": "2025-07-23T15:48:59.670Z",
      "category": "progress",
      "content": "âœ… **HYPOTHESIS CONFIRMED**: Found devlogs with status='done' but missing closedAt field (e.g., #250, #247) vs. devlogs with both status='done' AND closedAt field (e.g., #169). This explains the discrepancy:\n- Time series: counts only entries with both status='done'|'cancelled' AND closedAt field\n- Overview: counts any entry with status NOT in ['done', 'cancelled']\n\nNext: Need to count entries by these criteria to determine the scope of the inconsistency."
    },
    {
      "id": "bddc9ded-b682-4fb4-9eb7-eef092c303b8",
      "timestamp": "2025-07-23T15:51:12.959Z",
      "category": "solution",
      "content": "ðŸŽ¯ **ROOT CAUSE REFINED**: The issue is data integrity - `closedAt` should be a required field when status is \"done\" or \"cancelled\". Some entries have status=\"done\"/\"cancelled\" but missing closedAt field.\n\n**Solution approach:**\n1. Add data validation to ensure closedAt is set when status becomes \"done\"/\"cancelled\"\n2. Add migration/repair logic to fix existing entries with missing closedAt\n3. Consider updating both time series and overview to use consistent logic\n\nThis is a data consistency issue, not just a calculation discrepancy."
    },
    {
      "id": "628961bf-9a33-4b14-8ba6-d7f449ff2a2f",
      "timestamp": "2025-07-23T15:53:19.535Z",
      "category": "progress",
      "content": "âœ… **CORE FIXES IMPLEMENTED**: \n1. Fixed `completeDevlog()` to set `closedAt` field when status becomes 'done'\n2. Fixed `closeDevlog()` to set `closedAt` field when status becomes 'cancelled'  \n3. Added validation in `updateDevlog()` to automatically set `closedAt` when status changes to 'done'|'cancelled'\n\n**Next:** Need to fix existing entries with missing closedAt. Will use MCP tools to identify and repair the data inconsistencies."
    }
  ],
  "files": [],
  "relatedDevlogs": [],
  "context": {
    "businessContext": "Accurate statistics are critical for project management and reporting. Users rely on these numbers to understand project status and progress. Inconsistent data undermines trust in the system and can lead to poor decision-making.",
    "technicalContext": "Statistics are generated by different functions in the core package managers, likely DevlogManager or WorkspaceDevlogManager. The discrepancy suggests different filtering logic, workspace awareness, or data aggregation approaches between time series and overview statistics.",
    "dependencies": [],
    "decisions": [],
    "acceptanceCriteria": [
      "Time series and overview statistics show consistent counts for open devlogs",
      "Investigation identifies root cause of counting discrepancy",
      "Fix ensures all statistics use same filtering and counting logic",
      "No other statistics are affected by the fix"
    ],
    "risks": []
  },
  "aiContext": {
    "currentSummary": "",
    "keyInsights": [],
    "openQuestions": [],
    "relatedPatterns": [],
    "suggestedNextSteps": [],
    "lastAIUpdate": "2025-07-23T15:47:30.018Z",
    "contextVersion": 1
  },
  "closedAt": "2025-07-23T16:21:17.588Z"
}