{
  "id": 279,
  "key": "remove-legacy-codehist-references-from-codebase",
  "title": "Remove legacy 'codehist' references from codebase",
  "type": "refactor",
  "description": "Clean up remaining references to \"codehist\" throughout the codebase, replacing them with more appropriate terms like \"GitHub Copilot\", \"VS Code\", or generic chat import terminology. The package was renamed from @devlog/codehist ‚Üí @devlog/ai-chat ‚Üí @devlog/ai, but many comments, descriptions, method names, and configurations still reference the old \"codehist\" name which is confusing and outdated.",
  "status": "in-progress",
  "priority": "medium",
  "createdAt": "2025-07-24T13:59:47.120Z",
  "updatedAt": "2025-07-24T14:22:20.666Z",
  "notes": [
    {
      "id": "0f7318d0-40dc-4111-bca5-5a5949cc6e46",
      "timestamp": "2025-07-24T14:02:03.781Z",
      "category": "progress",
      "content": "Starting implementation with \"ChatHub\" as the new catchy name for the AI chat history handling module. This will replace all \"codehist\" references with \"ChatHub\" terminology throughout the codebase."
    },
    {
      "id": "7cd6abe4-816b-46af-866f-eb7404b5d727",
      "timestamp": "2025-07-24T14:05:04.685Z",
      "category": "idea",
      "content": "**Architecture Redesign Decision**: Instead of having a generic chat-import-service that references ChatHub, ChatHub itself should be the primary service. This means:\n\n1. Rename `chat-import-service.ts` ‚Üí `chat-hub-service.ts` \n2. `DefaultChatImportService` ‚Üí `ChatHubService`\n3. Methods become source-specific: `importFromGitHubCopilot()`, `importFromCursor()`, etc.\n4. ChatHub is positioned as the central hub for all AI chat history processing\n\nThis is much cleaner architecturally and makes the naming intuitive."
    },
    {
      "id": "a1ac9e15-3b6a-4b71-8f9e-4ea35d9cd823",
      "timestamp": "2025-07-24T14:05:25.356Z",
      "category": "progress",
      "content": "Updated Acceptance Criteria to reflect the ChatHub-centric architecture. The plan now focuses on making ChatHub the primary service rather than just removing 'codehist' references. This includes:\n\n- File rename: chat-import-service.ts ‚Üí chat-hub-service.ts\n- Class rename: DefaultChatImportService ‚Üí ChatHubService  \n- Interface rename: ChatImportService ‚Üí ChatHubService\n- Source-specific methods: importFromGitHubCopilot(), etc.\n- Complete package-wide refactoring to use ChatHub terminology\n\nThis gives us a much cleaner and more intuitive architecture."
    },
    {
      "id": "89fc76b4-27e2-44b3-873c-5ff60630e60c",
      "timestamp": "2025-07-24T14:11:12.587Z",
      "category": "progress",
      "content": "**Core refactoring completed**:\n\n‚úÖ **Architecture Changes**:\n- Renamed `chat-import-service.ts` ‚Üí `chat-hub-service.ts`\n- Created `IChatHubService` interface and `ChatHubService` implementation\n- Added typed `ChatSource` type with proper values: 'github-copilot', 'cursor', 'claude-code', 'windsurf', 'manual'\n\n‚úÖ **Types Updated**:\n- Updated `ChatImportConfig.source` to use `ChatSource` type\n- Updated `ChatImportProgress.source` to use `ChatSource` type\n- Updated file comments to reference proper AI chat sources\n\n‚úÖ **API Updates**:\n- Updated web API route to import and use `ChatHubService`\n- Default source changed to 'github-copilot'\n- Updated service exports in AI package\n\n**Next**: Update MCP tools and complete remaining references",
      "files": [
        "packages/core/src/types/chat.ts",
        "packages/ai/src/services/chat-hub-service.ts",
        "packages/ai/src/services/index.ts",
        "packages/web/app/api/workspaces/[id]/chat/import/route.ts"
      ]
    },
    {
      "id": "c2f7723d-c165-4143-b0d0-11a1672b81a0",
      "timestamp": "2025-07-24T14:15:31.060Z",
      "category": "idea",
      "content": "üîÑ **MAJOR ARCHITECTURE INSIGHT**: We had the data flow backwards!\n\n**‚ùå Current (wrong) approach**: \n- Server tries to import from local VS Code/AI agent storage\n- Requires server to access local file systems\n- Complex cross-platform discovery logic on server\n\n**‚úÖ Correct approach**:\n- **Local clients** (CLI tools, IDE extensions, desktop apps) read their own chat history  \n- **Clients stream/upload** chat data to API endpoints\n- **Server (ChatHub)** becomes a data ingestion and processing service\n- Clean separation: clients extract, server processes\n\nThis changes ChatHub from an \"importer\" to a \"receiver/processor\" of chat data streams."
    },
    {
      "id": "cdd06fb7-f382-474b-bb09-e808ed4a190e",
      "timestamp": "2025-07-24T14:17:27.278Z",
      "category": "idea",
      "content": "üîó **Related Architecture Work**: Created devlog #280 to extract CLI from @devlog/ai into separate @devlog/cli package.\n\nThis supports the new client-server architecture where:\n- **@devlog/cli** = local client for chat extraction and API communication\n- **ChatHub service** = server-side data ingestion and processing\n- **Clean separation** of concerns and better package management\n\nThe ChatHub refactoring in this entry aligns with the new CLI package structure."
    },
    {
      "id": "024685a1-37de-4a59-b0bc-3089a66c613c",
      "timestamp": "2025-07-24T14:18:25.216Z",
      "category": "progress",
      "content": "üîÑ **Pivoting to Receiver Architecture**: Repurposing ChatHub as a data receiver/processor instead of local importer.\n\n**New ChatHub Methods**:\n- `ingestChatSessions()` - Process incoming chat sessions from clients\n- `ingestChatMessages()` - Process incoming chat messages from clients  \n- `processIncomingData()` - Handle bulk chat data uploads\n- Remove local file extraction logic (moves to @devlog/cli)"
    },
    {
      "id": "d9a3ce7f-8cbd-4070-bb3f-779e575cec20",
      "timestamp": "2025-07-24T14:22:20.666Z",
      "category": "progress",
      "content": "üéâ **ChatHub Receiver Architecture Complete**!\n\n‚úÖ **New ChatHub Service Methods**:\n- `ingestChatSessions()` - Process incoming chat sessions from clients\n- `ingestChatMessages()` - Process incoming chat messages from clients  \n- `processBulkChatData()` - Handle bulk chat data uploads with progress tracking\n- Removed local file extraction logic (CopilotParser, etc.)\n\n‚úÖ **Updated API Endpoint**:\n- POST now expects `{sessions: [], messages: [], source: 'github-copilot', workspaceInfo: {}}` \n- Validates incoming data format\n- Uses ChatHub to process received data instead of triggering local imports\n- Clean client-server separation\n\n‚úÖ **Architecture Benefits**:\n- Server no longer needs local file system access\n- Clients handle extraction, server handles processing\n- Much cleaner separation of concerns\n- Ready for @devlog/cli integration\n\n**Status**: Core receiver architecture complete! Ready for CLI client development.",
      "files": [
        "packages/ai/src/services/chat-hub-service.ts",
        "packages/web/app/api/workspaces/[id]/chat/import/route.ts"
      ]
    }
  ],
  "files": [],
  "relatedDevlogs": [],
  "context": {
    "businessContext": "Removing outdated terminology improves code maintainability and reduces confusion for new developers. The \"codehist\" name was specific to the original Python project and doesn't clearly communicate the current functionality of GitHub Copilot chat import capabilities.",
    "technicalContext": "Architecture decision: ChatHub should be the primary service name, not just a source reference. The current chat-import-service.ts is too generic - ChatHub itself should be the service that handles importing from various AI chat history sources (GitHub Copilot, Cursor, Claude, etc.). This requires renaming the service file and restructuring the architecture to be ChatHub-centric.",
    "dependencies": [],
    "decisions": [],
    "acceptanceCriteria": [
      "Rename chat-import-service.ts to chat-hub-service.ts",
      "Create ChatHubService class to replace DefaultChatImportService",
      "Update ChatImportService interface to ChatHubService interface",
      "Method names become source-specific: importFromGitHubCopilot(), importFromCursor(), etc.",
      "All imports across packages updated to use ChatHubService",
      "MCP tools reference ChatHub as the primary service",
      "API routes use ChatHubService instead of DefaultChatImportService",
      "Comments and documentation position ChatHub as the central AI chat processing hub",
      "Remove all legacy 'codehist' references from active code",
      "Update type definitions and interfaces to use ChatHub terminology",
      "Maintain backward compatibility in API responses where possible"
    ],
    "risks": []
  },
  "aiContext": {
    "currentSummary": "",
    "keyInsights": [],
    "openQuestions": [],
    "relatedPatterns": [],
    "suggestedNextSteps": [
      "Rename chat-import-service.ts to chat-hub-service.ts",
      "Create ChatHubService class to replace DefaultChatImportService",
      "Update method names to be source-specific (importFromGitHubCopilot)",
      "Update all imports and references across packages",
      "Update MCP tools to use ChatHub terminology",
      "Update API routes to use ChatHub service"
    ],
    "lastAIUpdate": "2025-07-24T14:04:58.728Z",
    "contextVersion": 2
  }
}