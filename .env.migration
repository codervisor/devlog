# Phase 4: API Migration Configuration

# Enable Prisma services (set to 'true' to begin migration)
ENABLE_PRISMA_SERVICES=false

# Optionally migrate only specific services (comma-separated)
# If not set, all services will be migrated when ENABLE_PRISMA_SERVICES=true
# MIGRATE_SERVICES=ProjectService,DevlogService,AuthService

# Allow fallback to TypeORM on Prisma errors (recommended: 'true' during migration)
FALLBACK_ON_ERROR=true

## Migration Guide

### Phase 4 Steps:
1. **Test current setup**: All routes now use ServiceFactory with automatic fallback
2. **Enable gradual migration**: Set ENABLE_PRISMA_SERVICES=true when Prisma client is available
3. **Monitor and validate**: Services will automatically use Prisma with TypeORM fallback
4. **Complete migration**: Remove TypeORM services after full validation

### Service Migration Status:
- ✅ **API Routes Updated**: All major routes now use ServiceFactory
  - `/api/projects` - Project management
  - `/api/projects/[name]/devlogs` - Devlog operations  
  - `/api/auth/login` - Authentication
  - `/api/auth/register` - User registration
- ✅ **Service Factory**: Automatic service selection with fallback
- ✅ **Error Handling**: Graceful fallback when Prisma client unavailable
- ✅ **Type Safety**: All migrations maintain existing APIs

### Current Behavior:
- **ENABLE_PRISMA_SERVICES=false**: Uses TypeORM services (current default)
- **Prisma client unavailable**: Automatically falls back to TypeORM
- **Service APIs unchanged**: Drop-in replacement pattern

### Next Steps:
1. Generate Prisma client: `npx prisma generate` (requires network access)
2. Set ENABLE_PRISMA_SERVICES=true in environment
3. Test specific services: Set MIGRATE_SERVICES=ProjectService for gradual testing
4. Monitor logs for "falling back to TypeORM" messages
5. Complete migration when all services work with Prisma